% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/robust_statis_phase2.R
\name{robust_statis_phase2}
\alias{robust_statis_phase2}
\title{Robust STATIS Dual - Phase 2 (New Batches Evaluation)}
\usage{
robust_statis_phase2(
  new_data,
  variables,
  medians,
  mads,
  compromise_matrix,
  global_center
)
}
\arguments{
\item{new_data}{A data frame containing new batches to evaluate (usually out-of-control).}

\item{variables}{Character vector of variable names to use.}

\item{medians}{Named numeric vector of medians from Phase 1 (one per variable).}

\item{mads}{Named numeric vector of MADs from Phase 1 (one per variable).}

\item{compromise_matrix}{Robust compromise covariance matrix from Phase 1.}

\item{global_center}{Robust global center (vector) from Phase 1.}
}
\value{
A list with:
\describe{
\item{standardized_data}{Data frame with standardized values and distances per observation.}
\item{chi_stats_by_batch}{Chi-squared statistics per batch, calculated as the sum of squared distances.}
\item{threshold}{Chi-squared control limit based on degrees of freedom = number of variables * number of observations per batch.}
}
}
\description{
Applies the robust STATIS control chart methodology to new batches using the compromise matrix
and robust global center obtained in Phase 1. This function computes robust Mahalanobis distances
for each observation in new batches (Phase 2), standardizes the data using robust estimates
(median and MAD) from Phase 1, and then aggregates the distances per batch as the sum of squared
distances. This sum serves as the Phase 2 control statistic.
}
\details{
This approach is aligned with Phase 1 methodology, where each batch is evaluated using the
total contribution of its observations. The Mahalanobis distances are computed with respect
to the global robust center and the compromise matrix obtained in Phase 1.
}
\examples{
data("datos_farma")
phase1 <- robust_statis_phase1(
  subset(datos_farma, Status == "Under Control"),
  variables = c("Concentration", "Humidity", "Dissolution", "Density")
)
new_data <- subset(datos_farma, Status == "Out of Control")
result_phase2 <- robust_statis_phase2(
  new_data = new_data,
  variables = c("Concentration", "Humidity", "Dissolution", "Density"),
  medians = phase1$global_medians,
  mads = phase1$global_mads,
  compromise_matrix = phase1$compromise_matrix,
  global_center = phase1$global_center
)
result_phase2$standardized_data
}
